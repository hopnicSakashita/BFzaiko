====================================================================
在庫管理システム - グラデーション加工管理システム 使用マニュアル
====================================================================

■ 1. システム概要
====================================================================
【システム目的】
レンズのグラデーション加工（1回目加工・2回目加工）の依頼から出荷までを一元管理

【業務フロー】
1. コンベックス加工依頼登録 → 2. コンベックス加工データ管理 → 3. ニデック加工依頼作成 → 4. ニデック加工データ登録 → 5. 最終出荷作成

【基本操作】
- ログイン: ユーザーID・パスワード入力
- ナビゲーション: 左サイドメニューから各機能にアクセス
- 共通操作: 新規作成・編集・削除・検索ボタン

【画面一覧】
◆ コンベックス加工依頼管理
- コンベックス加工依頼作成画面（gprr_create.html）
- コンベックス依頼一覧画面（gprr_list.html）
- コンベックス加工依頼編集画面（gprr_edit.html）

◆ コンベックス加工データ管理
- コンベックス加工データ登録画面（gprc_create_from_gprr.html）
- コンベックス戻り一覧画面（gprc_list.html）

◆ ニデック加工依頼管理
- ニデック加工依頼作成画面（shipping_create.html）
- ニデック依頼一覧画面（gshk_list.html）
- ニデック加工依頼編集画面（gshk_edit.html）

◆ ニデック加工データ管理
- ニデック戻り一覧（2回目加工）画面（nidec_gprc_list.html）
- 最終出荷作成（ニデック加工完了）画面（nidec_shipping_create.html）
- ニデック加工データ登録画面（nidec_proc_create.html）

◆ 集計・検索画面
- 加工状況マトリックス画面（processing_matrix.html）
- 最終出荷データ検索画面（final_shipping_search.html）

■ 2. 主要操作手順
====================================================================
【2.1 コンベックス加工依頼登録】
1. サイドメニュー「グラデーション」→「コンベックス依頼一覧」
2. 「新規作成」ボタンをクリック
3. 「行追加」で入力行を追加（初期で1行表示）
4. 各項目を入力:
   - 規格: ドロップダウンから選択（2.00、4.00、6.00など）
   - 色: ドロップダウンから選択（ブラウン、グレーなど）
   - 依頼日: YYYY-MM-DD形式で入力
   - 数量: 1以上の数値を入力
5. 複数行入力する場合は「行追加」で行を追加
6. 「一括登録」で保存

【2.2 コンベックス加工データ管理】
1. コンベックス依頼一覧で「入庫」ボタン
2. 依頼データの確認（自動表示）
3. 加工データを入力:
   - 戻り日: 加工完了して戻ってきた日付
   - 戻り数量: 実際に戻ってきた数量
   - 戻り不良数: 加工中に不良になった数量
   - 検品不良数: 検品で不良と判定された数量
   - 合格数: 合格品の数量
4. 「登録」で保存

【2.3 ニデック加工依頼作成】
1. コンベックス戻り一覧で「出荷作成」ボタン
2. 加工データの確認（自動表示）
3. ニデック加工依頼データを入力:
   - 手配日: ニデック加工を手配した日付
   - 依頼日: 実際にニデック加工を依頼する日付
   - 依頼数量: ニデック加工を依頼する数量
4. 「一括依頼」で保存

【2.4 ニデック加工データ登録】
1. ニデック依頼一覧で「入庫」ボタン
2. ニデック加工依頼データの確認（自動表示）
3. ニデック加工データを入力:
   - 戻り日: ニデック加工が完了した日付
   - 戻り数量: 実際に戻ってきた数量
   - 戻り不良数: 加工中に不良になった数量
   - 検品不良数: 検品で不良と判定された数量
   - 合格数: 合格品の数量
4. 「登録」で保存

【2.5 最終出荷作成】
1. ニデック戻り一覧で「出荷作成」ボタン
2. ニデック加工データの確認（自動表示）
3. 最終出荷データを入力:
   - 手配日: 最終出荷を手配した日付
   - 出荷日: 実際に最終出荷する日付
   - 出荷数量: 最終出荷する数量
4. 「一括出荷」で保存

■ 3. 入力ルール・制約事項
====================================================================
【数量整合性ルール】
- 戻り数量 = 戻り不良数 + 検品不良数 + 合格数
- 依頼数量 ≤ 在庫数量（依頼可能数）
- 出荷数量 ≤ 出荷可能数
- 加工残数 = 依頼数量 - 戻り数量合計

【日付ルール】
- 戻り日は依頼日以降の日付を入力
- 手配日は戻り日以降の日付を入力
- 出荷日は手配日以降の日付を入力
- 過去の日付も入力可能

【削除制限ルール】
- 加工データが存在する依頼データは削除不可
- ニデック加工データが存在するニデック加工依頼データは削除不可
- 関連データを先に削除してから削除する必要がある

【編集制限ルール】
- 加工データが存在する依頼データは編集不可
- ニデック加工データが存在するニデック加工依頼データは編集不可
- 編集不可の場合は「編集」ボタンが無効化される

■ 4. よくあるエラーと対処法
====================================================================
【入力形式エラー】
- 「すべての項目を入力してください」→ 必須項目に値を入力
- 「数値または日付の形式が正しくありません」→ 数値項目に数字のみ、日付はYYYY-MM-DD形式
- 「指定されたデータが見つかりません」→ 一覧画面を更新して最新データを確認

【数量整合性エラー】
- 「戻り数量が加工残数を超えています」→ 戻り数量を依頼数量以下に修正
- 「依頼数量が依頼可能数を超えています」→ 依頼数量を在庫数量以下に修正
- 「出荷数量が出荷可能数を超えています」→ 出荷数量を在庫数量以下に修正
- 「戻り不良数と検品不良数の合計が戻り数を超えています」→ 戻り数量 = 不良数合計 + 合格数 に修正

【削除・編集制限エラー】
- 「削除できません」→ 関連データを先に削除してから削除
- 「編集できません」→ 関連データを先に削除してから編集
- 削除順序: ニデック加工データ → ニデック加工依頼データ → 加工データ → 依頼データ

【システムエラー】
- 「データベース接続エラー」→ システム管理者に連絡
- 「予期せぬエラーが発生しました」→ ブラウザを更新して再試行、またはシステム管理者に連絡

■ 5. 検索・確認機能
====================================================================
【加工状況マトリックス】
- アクセス: サイドメニュー「グラデーション」→「加工状況マトリックス」
- 機能: 規格・色別の未戻り数と在庫数を確認
- 表示形式: 「未戻り数 / 在庫数」の形式
- 印刷機能: 「印刷」ボタンで印刷可能

【最終出荷データ検索】
- アクセス: サイドメニュー「グラデーション」→「最終出荷データ検索」
- 検索条件: 出荷日範囲、手配日範囲、フラグ
- 表示項目: 出荷ID、出荷日、手配日、規格、色、数量

【各一覧画面の検索機能】
- コンベックス依頼一覧: 規格、色、依頼日範囲、残数フラグ
- コンベックス戻り一覧: 規格、色、戻り日範囲、在庫状況
- ニデック依頼一覧: 出庫日範囲、処理状況
- ニデック戻り一覧: 規格、色、戻り日範囲、在庫状況

【データ確認のポイント】
- 加工状況マトリックスで全体状況を把握
- 残数と在庫数の関係を確認
- 依頼可能数・出荷可能数の確認
- 定期的に加工状況マトリックスを確認

■ 6. サポート・連絡先
====================================================================
【エラー時の対応手順】
1. エラーメッセージの内容を確認
2. 操作手順を見直す
3. ブラウザを更新して再試行
4. システム管理者に連絡

【連絡先】
- システム管理者: [管理者の連絡先]
- 業務担当者: [担当者の連絡先]
- サポート時間: 平日9:00～18:00
- 緊急時: 24時間対応（システム障害時のみ）

【サポート依頼時の準備】
- エラーメッセージの内容
- 操作手順の詳細
- 発生時刻と状況
- ブラウザの種類とバージョン

