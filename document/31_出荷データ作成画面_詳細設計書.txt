# 出荷データ作成画面詳細設計書

## 1. 概要
入庫データに対する出荷データを作成・管理する画面。
複数の出荷データを一括で登録でき、既存の出荷データの編集・削除も可能。

## 2. 画面構成
### 2.1 入庫データ情報表示部
- 入庫ID、製品ID、製品名、LOT、ランク、入庫数量、在庫残数を表示
- カード形式で見やすく表示

### 2.2 出荷データ入力フォーム
- 行追加・削除ボタンによる動的な入力行の管理
- 各行に以下の入力項目を配置：
  - 出荷区分（必須）：出荷/加工/欠損から選択
  - 出荷日（必須）：日付入力
  - 手配日（必須）：日付入力
  - 出荷数量（必須）：数値入力（1以上、在庫残数以下）
  - 出荷先：出荷区分が「出荷」の場合のみ表示
  - 加工：出荷区分が「加工」の場合のみ表示

### 2.3 出荷データ一覧
- 登録済みの出荷データをテーブル形式で表示
- 各行に編集・削除ボタンを配置

### 2.4 編集モーダル
- 既存の出荷データを編集するためのモーダルウィンドウ
- 入力フォームと同様の項目を編集可能

## 3. 機能詳細
### 3.1 初期表示
1. 入庫データ情報の表示
2. 出荷データ一覧の取得・表示
3. 得意先リストの取得
4. 加工リストの取得
5. 入力フォームに初期行を追加

### 3.2 出荷データ一括登録
1. 入力値のバリデーション
   - 必須項目チェック
   - 出荷区分に応じた項目チェック
   - 数量の妥当性チェック
   - 合計数量と在庫残数の比較
2. 各行のデータを順次登録
3. 登録結果の集計・表示
4. 在庫残数の更新
5. 出荷データ一覧の再表示

### 3.3 出荷データ編集
1. 編集対象データの取得・表示
2. 入力値のバリデーション
3. データ更新処理
4. 在庫残数の更新
5. 出荷データ一覧の再表示

### 3.4 出荷データ削除
1. 削除確認ダイアログの表示
2. 削除処理の実行
3. 在庫残数の更新
4. 出荷データ一覧の再表示

## 4. イベント処理
### 4.1 出荷区分変更時
1. 出荷先/加工選択フィールドの表示制御
2. 対応するリストデータの設定
3. 列の表示・非表示を更新

### 4.2 フォームクリア
1. 入力行の削除
2. 初期行の追加
3. 列の表示・非表示を更新

## 5. エラー処理
### 5.1 一括登録時
- 必須項目未入力
- 出荷区分別の必須項目未選択
- 数量の範囲外入力
- 合計数量超過
- 通信エラー

### 5.2 編集時
- 必須項目未入力
- 出荷区分別の必須項目未選択
- データ取得エラー
- 更新処理エラー

### 5.3 削除時
- 削除処理エラー
- 通信エラー

## 6. API連携
### 6.1 取得API
- 得意先リスト取得：/common/api/get_customer_list
- 加工リスト取得：/common/api/get_cprc_list/{製品ID}
- 出荷データ一覧取得：/common/api/get_shipment_list/{入庫ID}
- 在庫残数取得：/common/api/get_zaiko_zan/{入庫ID}

### 6.2 更新API
- 出荷データ登録：/common/cprd_dat/shipment (POST)
- 出荷データ更新：/common/cprd_dat/shipment/update (POST)
- 出荷データ削除：/common/cprd_dat/shipment/delete (POST)

## 7. セキュリティ考慮事項
- 入力値のサニタイズ
- 数量入力の範囲制限
- 不正なAPIリクエストの防止
- CSRF対策（Flaskの標準機能を使用）

## 8. パフォーマンス考慮事項
- 一括登録時の非同期処理
- エラー発生時の部分的なロールバック
- 必要な場合のみ列表示の更新
- 不要なAPI呼び出しの抑制 