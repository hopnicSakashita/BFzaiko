====================================================================
在庫管理システム - 受注データ検索画面 詳細設計書
====================================================================

■ 1. 画面概要
====================================================================
【画面名】
　受注データ検索画面

【画面目的】
　受注データの検索・一覧表示・詳細確認・出荷状況確認機能を提供し、
　受注管理と出荷計画の策定を支援する。

【アクセス情報】
　- URL: /order_search
　- 認証: 必須（ログイン必須）

■ 2. 機能概要
====================================================================
【主要機能】
　1. 検索条件による受注データのフィルタリング表示
　2. 受注データの一覧表示（受注日、出荷先、製品情報、出荷状況等）
　3. 検索結果の詳細情報確認
　4. 受注残数量の自動計算表示
　5. 出荷作成画面への遷移機能

【検索条件】
　- 受注日: 特定日付による絞り込み
　- 製品ID: 部分一致検索による製品特定
　- ベース: レンズのベースカーブ値（2、4、6、8）による絞り込み
　- 加入度数: レンズの度数（150、175、200、225、250、275、300）による絞り込み
　- L/R: 左右識別（L、R）による絞り込み
　- 色: レンズの色（BR、SG）による絞り込み
　- 加工区分: 加工種別（ノンコート、ハードコート）による絞り込み
　- 出荷先: 取引先による絞り込み
　- 客先受注番号: 数値による完全一致検索
　- 受注残: 受注残の有無による絞り込み（あり、なし、全て）

【表示フィルタ】
　- 未出荷の有効な受注データのみ対象
　- 受注日、加工種別、取引先、製品IDの順序で並び替え表示

■ 3. 画面レイアウト
====================================================================
【3.1 画面構造】
```
├── 共通ヘッダー（ナビゲーション）
├── サイドメニュー
└── メインコンテンツエリア
    ├── ページタイトル「受注データ検索」
    ├── 検索条件フォーム
    ├── 操作ボタン（検索）
    └── 検索結果テーブル
```

【3.2 検索フォーム】
```
┌─────────────────────────────────────────────────────────────┐
│                      検索条件                               │
├──────────┬──────────┬──────────┬──────────┬──────────────────┤
│ 受注日   │ 製品ID   │  ベース  │加入度数  │                  │
│[日付選択]│[入力欄]  │[選択▼]  │[選択▼]   │                  │
├──────────┼──────────┼──────────┼──────────┼──────────────────┤
│  L/R    │   色     │ 加工区分  │ 出荷先   │                  │
│[選択▼]  │[選択▼]   │[選択▼]   │[選択▼]   │                  │
├──────────┼──────────┼──────────┼──────────┼──────────────────┤
│客先受注番号│ 受注残   │          │          │                  │
│[入力欄]   │[選択▼]   │          │          │                  │
├─────────────────────────────────────────────────────────────┤
│ [検索]                                                      │
└─────────────────────────────────────────────────────────────┘
```

【3.3 検索結果テーブル】
```
┌─────────────────────────────────────────────────────────────┐
│                      受注データ一覧                         │
├──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┬──────┤
│受注日│ベース│加入度数│ L/R │ 色  │加工区分│出荷先│客先受注│受注数│受注残│
│     │     │      │     │     │      │     │番号   │     │     │
├──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┼──────┤
│24/01/15│  2  │ 150  │  L  │ BR │  NC  │ｺﾛﾝﾊﾞｽ│123456│  50 │  25 │
│24/01/14│  4  │ 200  │  R  │ SG │  HC  │ダラス│789012│  30 │   0 │
└──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┘
```

■ 4. データ項目
====================================================================
【4.1 検索条件項目】

◆ 受注日
　- データ型: 日付（YYYY-MM-DD形式）
　- 入力方式: 日付選択フィールド
　- 検索方式: 完全一致（日付のみ比較、時間は無視）

◆ 製品ID
　- データ型: 文字列（4桁）
　- 入力方式: テキスト入力
　- 検索方式: 部分一致（LIKE検索）

◆ ベース
　- データ型: 数値（1桁）
　- 入力方式: セレクトボックス
　- 選択肢: 全て、2、4、6、8（BFSP_MSTから動的取得）
　- 説明: レンズのベースカーブ値

◆ 加入度数
　- データ型: 数値（3桁）
　- 入力方式: セレクトボックス
　- 選択肢: 全て、150、175、200、225、250、275、300（BFSP_MSTから動的取得）
　- 説明: レンズの度数

◆ L/R
　- データ型: 文字列（1桁）
　- 入力方式: セレクトボックス
　- 選択肢: 全て、L、R（BFSP_MSTから動的取得）
　- 説明: 左右の目用識別

◆ 色
　- データ型: 文字列（2桁）
　- 入力方式: セレクトボックス
　- 選択肢: 全て、BR、SG（BFSP_MSTから動的取得）
　- 説明: レンズの色

◆ 加工区分
　- データ型: 数値（1桁）
　- 入力方式: セレクトボックス
　- 選択肢: 全て、ノンコート、ハードコート
　- 内部値: 0（ノンコート）、1（ハードコート）

◆ 出荷先
　- データ型: 数値（1桁）
　- 入力方式: セレクトボックス
　- 選択肢: BZTR_MSTテーブルから動的取得
　- 説明: 受注先の取引先

◆ 客先受注番号
　- データ型: 数値（10桁）
　- 入力方式: テキスト入力
　- 検索方式: 完全一致
　- バリデーション: 数値のみ受付

◆ 受注残
　- データ型: 文字列
　- 入力方式: セレクトボックス
　- 選択肢: 全て、あり、なし
　- 業務ルール: 
　  - あり: 受注残数量 > 0 のデータのみ表示
　  - なし: 受注残数量 = 0 のデータのみ表示

【4.2 一覧表示項目】

◆ 受注日
　- 表示形式: YYYY-MM-DD
　- 説明: 受注を受けた日付

◆ ベース
　- 表示形式: 数値表示
　- 説明: レンズのベースカーブ値

◆ 加入度数
　- 表示形式: 数値表示
　- 説明: レンズの度数

◆ L/R
　- 表示形式: L または R
　- 説明: 左右の目用識別

◆ 色
　- 表示形式: 色コード表示（BR、SG）
　- 説明: レンズの色

◆ 加工区分
　- 表示形式: NC または HC
　- 説明: レンズの加工種別
　- 変換ルール: 0→NC、1→HC

◆ 出荷先
　- 表示形式: 取引先名称
　- 説明: 受注先の取引先名称

◆ 客先受注番号
　- 表示形式: 数値表示（NULL時は空文字）
　- 説明: 顧客が発行した注文番号

◆ 受注数
　- 表示形式: 右寄せ数値表示
　- 説明: 受注した数量

◆ 受注残
　- 表示形式: 右寄せ数値表示
　- 説明: まだ出荷されていない数量
　- 計算方法: `dbo.Get_ODR_ZAN_Qty_BF`関数による自動計算

■ 5. 業務ルール
====================================================================
【5.1 検索処理ルール】

◆ データ対象範囲
　- 未出荷の有効な受注データのみ対象（BRCP_FLG = DatabaseConstants.BRCP_FLG_NOT_SHIPPED）
　- 受注データ、BF規格マスタ、取引先マスタを結合して表示

◆ 検索条件適用ルール
　- 全ての検索条件はAND条件で適用
　- 空欄・「全て」選択時は該当条件を無視
　- 製品IDは部分一致、その他は完全一致
　- 受注日は日付部分のみ比較（時間は無視）

◆ 受注残計算ルール
　- `dbo.Get_ODR_ZAN_Qty_BF`関数を使用した受注残数量の自動計算
　- 出荷済み数量を受注数量から差し引いた値を表示
　- 計算結果が負の値の場合は0を表示

◆ 並び順ルール
　- 第1ソート: 受注日（昇順）
　- 第2ソート: 加工種別（0→1の順）
　- 第3ソート: 取引先ID（昇順）
　- 第4ソート: 製品ID（昇順）

【5.2 バリデーションルール】

◆ 入力値チェック
　- 客先受注番号: 数値のみ受付、文字列入力時はエラー表示
　- 受注日: 有効な日付形式のみ受付

◆ 検索結果チェック
　- 検索条件に一致するデータが0件の場合は情報メッセージ表示
　- データベースエラー時は適切なエラーメッセージ表示

【5.3 表示制御ルール】

◆ 選択肢動的生成
　- ベース、加入度数、L/R、色: BFSP_MSTテーブルから重複除外で取得
　- 出荷先: BZTR_MSTテーブルから取得（ID順で並び替え）

◆ 初期表示
　- GET リクエスト時は検索フォームのみ表示
　- POST リクエスト時は検索結果も含めて表示

■ 6. エラー処理
====================================================================
【6.1 バリデーションエラー】
　- 客先受注番号非数値エラー: 「客先受注番号は数値で入力してください。」
　- 日付形式エラー: 不正な日付入力での警告表示

【6.2 データベースエラー】
　- 選択肢取得エラー: 「選択肢の取得中にエラーが発生しました。」
　- 出荷先リスト取得エラー: 「出荷先リストの取得中にエラーが発生しました。」
　- 検索実行エラー: 「受注データの検索中にエラーが発生しました。」

【6.3 システムエラー】
　- 認証エラー: 未ログイン時のログイン画面リダイレクト
　- 予期しないエラー: 「受注データ検索中にエラーが発生しました: [エラー内容]」

【6.4 情報メッセージ】
　- 検索結果0件: 「検索条件に一致する受注データが見つかりませんでした。」

■ 7. 関連データ・機能
====================================================================
【7.1 関連テーブル】
　- BRCP_DAT: 受注データテーブル（メイン）
　- BFSP_MST: BF規格マスタテーブル（製品情報）
　- BZTR_MST: 取引先マスタテーブル（出荷先情報）

【7.2 関連機能】
　- dbo.Get_ODR_ZAN_Qty_BF(): 受注残数量計算関数
　- 出荷作成画面: 受注データから出荷作業への遷移
　- 受注データ入力画面: 受注データの新規作成・更新
　- 出荷一覧画面: 出荷済みデータとの連携確認

【7.3 業務フロー連携】
　- 受注入力 → 受注検索 → 出荷作成 → 出荷一覧の業務フロー
　- 在庫状況と受注残の照合による出荷計画策定支援
　- 取引先別・製品別の受注状況把握
