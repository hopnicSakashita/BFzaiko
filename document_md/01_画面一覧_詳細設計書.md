# 画面一覧 詳細設計書

## 1. システム概要

### システム名
在庫管理システム（BFzaiko）

### システム目的
BF系統と一般系統の在庫管理・出荷管理・加工管理を統合的に行い、業務効率化とデータ精度向上を実現する。

### システム構成
- **BF系統**: 特殊製品向けの在庫・出荷管理
- **一般系統**: 標準製品向けの在庫・出荷管理
- **共通機能**: マスタ管理・バーコード・データ取込

## 2. 画面構成一覧

### 2.1 認証・共通画面

#### 01. ログイン画面
- **URL**: `/login`
- **ファイル**: `app/templates/login.html`
- **機能**: ユーザー認証
- **実装**: `app/auth.py:login()`

#### 02. トップページ（アコーディオンメニュー）
- **URL**: `/`
- **ファイル**: `app/templates/index.html`
- **機能**: システムメニュー表示（アコーディオン形式）
- **実装**: `app/routes.py:index()`
- **メニュー構成**: 
  - BF（10機能）
  - 一般（6機能）
  - バーコード（3機能）
  - グラデーション（7機能）
  - マスタ管理（6機能）

### 2.2 BFカテゴリ（10機能）

#### 03. BF受注データ入力
- **URL**: `/order_input`
- **ファイル**: `app/templates/order_input.html`
- **機能**: BF受注データの入力・管理
- **実装**: `app/routes.py:order_input()`

#### 04. BF受注データ検索
- **URL**: `/order_search`
- **ファイル**: `app/templates/order_search.html`
- **機能**: BF受注データの検索・表示
- **実装**: `app/routes.py:order_search()`

#### 05. BF在庫検索機能（ノンコート）
- **URL**: `/noncoat_stock_search`
- **ファイル**: `app/templates/noncoat_stock_search.html`
- **機能**: ノンコート在庫の検索・表示
- **実装**: `app/routes.py:noncoat_stock_search()`

#### 06. BF在庫検索機能（ハードコート）
- **URL**: `/hardcoat_stock_search`
- **ファイル**: `app/templates/hardcoat_stock_search.html`
- **機能**: ハードコート在庫の検索・表示
- **実装**: `app/routes.py:hardcoat_stock_search()`

#### 07. BF出荷管理機能
- **URL**: `/shipment_list`
- **ファイル**: `app/templates/shipment_list.html`
- **機能**: BF出荷データの管理・検索
- **実装**: `app/routes.py:shipment_list()`

#### 08. BF製造明細管理機能
- **URL**: `/bprd_mei_list`
- **ファイル**: `app/templates/bprd_mei_list.html`
- **機能**: BF製造明細の管理
- **実装**: `app/routes.py:bprd_mei_list()`

#### 09. BF加工指示書管理機能
- **URL**: `/proc_order`
- **ファイル**: `app/templates/proc_order.html`
- **機能**: BF加工指示書の管理
- **実装**: `app/routes.py:proc_order()`

#### 10. ハードコートExcel読込機能
- **URL**: `/hardcoat_read_excel`
- **ファイル**: `app/templates/hardcoat_read_excel.html`
- **機能**: ハードコートExcelデータの読込・処理
- **実装**: `app/routes.py:hardcoat_read_excel()`

#### 11. ハードコート自動出荷機能
- **URL**: `/hardcoat_auto_shipping`
- **ファイル**: `app/templates/hardcoat_auto_shipping.html`
- **機能**: ハードコートの自動出荷処理
- **実装**: `app/routes.py:hardcoat_auto_shipping()`

### 2.3 一般カテゴリ（6機能）

#### 12. 一般出荷管理機能
- **URL**: `/common/shipment_list`
- **ファイル**: `app/templates/common/common_shipment_list.html`
- **機能**: 一般出荷データの管理・検索
- **実装**: `app/routes_common.py:shipment_list()`

#### 13. 一般入庫管理機能
- **URL**: `/common/cprd_dat_list`
- **ファイル**: `app/templates/common/cprd_dat_list.html`
- **機能**: 一般入庫データの管理
- **実装**: `app/routes_common.py:cprd_dat_list()`

#### 14. 一般入庫データ作成
- **URL**: `/common/cprd_dat/create`
- **ファイル**: `app/templates/common/cprd_dat_create.html`
- **機能**: 一般入庫データの新規作成
- **実装**: `app/routes_common.py:cprd_dat_create()`

#### 15. 一般入庫データ編集
- **URL**: `/common/cprd_dat/<id>/edit`
- **ファイル**: `app/templates/common/cprd_dat_edit.html`
- **機能**: 一般入庫データの編集
- **実装**: `app/routes_common.py:cprd_dat_edit()`

#### 16. 一般入庫データ出荷作成
- **URL**: `/common/cprd_dat/<id>/shipment_create`
- **ファイル**: `app/templates/common/cprd_dat_shipment_create.html`
- **機能**: 入庫データからの出荷作成
- **実装**: `app/routes_common.py:cprd_dat_shipment_create()`

#### 17. 一般加工データ作成
- **URL**: `/common/cprc_dat/<id>/create`
- **ファイル**: `app/templates/common/cprc_dat_create.html`
- **機能**: 一般加工データの作成
- **実装**: `app/routes_common.py:cprc_dat_create()`

#### 18. 在庫詳細表示
- **URL**: `/common/stock_detail/<prd_id>/<rank>`
- **ファイル**: `app/templates/common/common_stock_detail.html`
- **機能**: 在庫の詳細情報表示
- **実装**: `app/routes_common.py:stock_detail()`

#### 19. 在庫集計一覧
- **URL**: `/common/stock_summary`
- **ファイル**: `app/templates/common/common_stock_summary.html`
- **機能**: 在庫の集計情報表示
- **実装**: `app/routes_common.py:stock_summary()`

### 2.4 バーコードカテゴリ（3機能）

#### 20. バーコード機能
- **URL**: `/barcode_scan`
- **ファイル**: `app/templates/barcode_scan.html`
- **機能**: バーコード生成・スキャン・検証
- **実装**: `app/routes.py:barcode_scan()`

#### 21. バーコードインポート機能
- **URL**: `/barcode_import`
- **ファイル**: `app/templates/barcode_import.html`
- **機能**: バーコードデータのインポート
- **実装**: `app/routes.py:barcode_import()`

#### 22. バーコードCSVスキャン機能
- **URL**: `/barcode_scan_csv`
- **ファイル**: `app/templates/barcode_scan_csv.html`
- **機能**: CSVファイルによるバーコード検証
- **実装**: `app/routes.py:barcode_scan_csv()`

### 2.5 マスタ管理カテゴリ（6機能）

#### 23. 区分マスタ管理
- **URL**: `/master/kbn/list`
- **ファイル**: `app/templates/master/kbn_list.html`
- **機能**: 区分マスタの管理
- **実装**: `app/routes_master.py:kbn_list()`

#### 24. 加工マスタ管理
- **URL**: `/master/cprc/list`
- **ファイル**: `app/templates/master/cprc_list.html`
- **機能**: 加工マスタの管理
- **実装**: `app/routes_master.py:cprc_list()`

#### 25. 取引先マスタ管理
- **URL**: `/master/cztr/list`
- **ファイル**: `app/templates/master/cztr_list.html`
- **機能**: 取引先マスタの管理
- **実装**: `app/routes_master.py:cztr_list()`

#### 26. 製品マスタ管理
- **URL**: `/master/prd/list`
- **ファイル**: `app/templates/master/prd_list.html`
- **機能**: 製品マスタの管理
- **実装**: `app/routes_master.py:prd_list()`

#### 27. 製品区分マスタ管理
- **URL**: `/master/cbcd/list`
- **ファイル**: `app/templates/master/cbcd_list.html`
- **機能**: 製品区分マスタの管理
- **実装**: `app/routes_master.py:cbcd_list()`

#### 28. 加工集計グループマスタ管理
- **URL**: `/master/cprg/list`
- **ファイル**: `app/templates/master/cprg_list.html`
- **機能**: 加工集計グループマスタの管理
- **実装**: `app/routes_total.py:cprg_list()`

## 3. 画面遷移図

### 3.1 メイン画面遷移

```
ログイン画面
    ↓
トップページ（アコーディオンメニュー）
    ↓
├─ BF（アコーディオン）
│   ├─ 受注データ入力
│   ├─ 受注データ検索
│   ├─ NCCSV取込
│   ├─ NC製造明細
│   ├─ NC在庫検索
│   ├─ 加工手配
│   ├─ 指図書読込
│   ├─ HC在庫検索
│   ├─ HC自動出荷
│   └─ 出荷データ
├─ 一般（アコーディオン）
│   ├─ 入庫CSV取込
│   ├─ 入庫データ一覧
│   ├─ 加工依頼一覧
│   ├─ 出荷一覧
│   ├─ 在庫集計一覧
│   └─ 加工集計マトリックス
├─ バーコード（アコーディオン）
│   ├─ スキャン
│   ├─ CSV取込
│   └─ CSVスキャン
├─ グラデーション（アコーディオン）
│   ├─ コンベックス依頼一覧
│   ├─ コンベックス戻り一覧
│   ├─ ニデック依頼一覧
│   ├─ ニデック戻り一覧
│   ├─ 加工状況表
│   ├─ 最終出荷検索
│   └─ 自動出荷
└─ マスタ管理（アコーディオン）
    ├─ 区分マスタ一覧
    ├─ 加工マスタ一覧
    ├─ 取引先マスタ一覧
    ├─ 製品マスタ一覧
    ├─ バーコードマスタ一覧
    └─ 加工集計グループマスタ一覧
```

### 3.2 カテゴリ別画面遷移

#### BFカテゴリ画面遷移
```
BF受注データ入力
BF受注データ検索
BF系統CSV取込機能（NCCSV取込）
BF製造明細管理機能（NC製造明細）
BF在庫検索機能（ノンコート）（NC在庫検索）
BF加工指示書管理機能（加工手配）
ハードコートExcel読込機能（指図書読込）
BF在庫検索機能（ハードコート）（HC在庫検索）
ハードコート自動出荷機能（HC自動出荷）
BF出荷管理機能（出荷データ）
```

#### 一般カテゴリ画面遷移
```
一般系統CSV取込機能（入庫CSV取込）
一般入庫管理機能（入庫データ一覧）
加工依頼管理機能（加工依頼一覧）
一般出荷管理機能（出荷一覧）
在庫集計一覧（在庫集計一覧）
加工集計マトリックス機能（加工集計マトリックス）
```

#### バーコードカテゴリ画面遷移
```
バーコード機能（スキャン）
バーコードインポート機能（CSV取込）
バーコードCSVスキャン機能（CSVスキャン）
```

#### マスタ管理カテゴリ画面遷移
```
区分マスタ管理（区分マスタ一覧）
加工マスタ管理（加工マスタ一覧）
取引先マスタ管理（取引先マスタ一覧）
製品マスタ管理（製品マスタ一覧）
製品区分マスタ管理（バーコードマスタ一覧）
加工集計グループマスタ管理（加工集計グループマスタ一覧）
```

## 4. 画面詳細仕様

### 4.1 認証・共通画面

#### ログイン画面
- **認証方式**: ユーザーID・パスワード認証
- **セッション管理**: Flask-Session
- **セキュリティ**: CSRF対策、パスワードハッシュ化

#### トップページ
- **メニュー構成**: 機能別メニュー表示
- **権限制御**: ユーザー権限によるメニュー表示制御
- **ナビゲーション**: ブレッドクラム表示

### 4.2 BF系統画面

#### BF受注データ入力
- **入力項目**: 受注番号、製品情報、数量、納期
- **検証機能**: 必須項目チェック、数量妥当性チェック
- **連携機能**: 在庫確認、出荷データ連携

#### BF在庫検索機能
- **検索条件**: 製品ID、LOT、在庫数量
- **表示項目**: 在庫詳細、出荷可能数量
- **操作機能**: 出荷作成、在庫詳細表示

#### BF出荷管理機能
- **検索条件**: 出荷日、出荷先、製品情報
- **表示項目**: 出荷一覧、数量、ステータス
- **操作機能**: 出荷作成、削除、PDF出力、バーコード生成

#### BF製造明細管理機能
- **管理項目**: 製造明細、数量、ステータス
- **操作機能**: 新規作成、編集、削除
- **連携機能**: 在庫データ連携

#### BF加工指示書管理機能
- **管理項目**: 加工指示、数量、加工先
- **操作機能**: 指示書発行、進捗管理
- **連携機能**: 製造明細連携

### 4.3 一般系統画面

#### 一般出荷管理機能
- **検索条件**: 出荷日範囲、出荷先、製品情報
- **表示項目**: 出荷一覧、数量、ステータス
- **操作機能**: 出荷作成、削除、PDF出力、バーコード生成

#### 一般入庫管理機能
- **管理項目**: 入庫データ、数量、LOT情報
- **操作機能**: 新規作成、編集、削除、出庫作成
- **連携機能**: 在庫データ連携

#### データ取込機能
- **取込形式**: CSVファイル
- **対象データ**: 入庫データ、出荷データ
- **検証機能**: データ形式チェック、重複チェック
- **エラー処理**: エラー箇所の特定・表示

#### バーコード機能
- **生成機能**: 出荷先別バーコード生成
- **スキャン機能**: カメラによるDataMatrix読み取り
- **検証機能**: 期待値との照合
- **連携機能**: 出荷一覧からの一括生成

### 4.4 マスタ管理画面

#### マスタ管理機能
- **管理対象**: 製品マスタ、区分マスタ、加工マスタ、取引先マスタ
- **操作機能**: 新規作成、編集、削除、一覧表示
- **検索機能**: 条件指定による絞り込み
- **連携機能**: 各機能画面との連携

### 4.5 加工管理画面

#### 加工依頼管理機能
- **管理項目**: 加工依頼、数量、加工先
- **操作機能**: 新規作成、編集、削除、進捗管理
- **連携機能**: 入庫データ・出荷データ連携

#### 加工集計マトリックス機能
- **表示形式**: マトリックス形式での在庫状況表示
- **集計項目**: 在庫数、加工残数、加工後在庫
- **検索条件**: 加工集計グループ
- **出力機能**: 印刷機能

## 5. 技術仕様

### 5.1 フレームワーク・ライブラリ
- **Webフレームワーク**: Flask
- **テンプレートエンジン**: Jinja2
- **データベース**: SQL Server
- **ORM**: SQLAlchemy
- **フロントエンド**: Bootstrap 5、jQuery

### 5.2 セキュリティ仕様
- **認証**: セッションベース認証
- **認可**: ロールベースアクセス制御
- **CSRF対策**: CSRFトークン検証
- **SQLインジェクション対策**: パラメータ化クエリ
- **XSS対策**: テンプレートエンジンによる自動エスケープ

### 5.3 パフォーマンス仕様
- **データベース**: インデックス最適化
- **キャッシュ**: セッションキャッシュ
- **非同期処理**: JavaScriptによる非同期通信
- **ページネーション**: 大量データの分割表示

## 6. 運用・保守

### 6.1 ログ機能
- **アクセスログ**: ユーザーアクセスの記録
- **エラーログ**: システムエラーの詳細記録
- **操作ログ**: データ変更操作の記録
- **パフォーマンスログ**: 処理時間の監視

### 6.2 監視・アラート
- **システム監視**: サーバー・データベース監視
- **エラー通知**: 重大エラーの即座通知
- **パフォーマンス監視**: レスポンス時間監視
- **データ整合性監視**: データ不整合の検出

### 6.3 バックアップ・復旧
- **データベースバックアップ**: 定期バックアップ
- **ファイルバックアップ**: アップロードファイルのバックアップ
- **復旧手順**: 障害時の復旧手順書
- **テスト環境**: 本番環境との分離

## 7. システム制約・注意事項

### 7.1 技術制約
- **データベース**: SQL Serverに依存
- **フレームワーク**: Flaskに依存
- **ブラウザ対応**: モダンブラウザ（Chrome、Firefox、Edge）
- **ファイルサイズ**: アップロードファイルのサイズ制限

### 7.2 運用制約
- **同時接続数**: サーバーリソースによる制限
- **データ量**: 大量データ処理時のパフォーマンス制限
- **バックアップ**: 定期バックアップの必要性
- **メンテナンス**: システム停止時の影響範囲

### 7.3 セキュリティ制約
- **認証**: セッションベース認証の制限
- **権限**: ユーザー権限による機能制限
- **データ保護**: 機密データの取り扱い制限
- **アクセス制御**: ネットワークアクセスの制限 